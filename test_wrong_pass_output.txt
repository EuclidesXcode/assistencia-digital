yarn run v1.22.22
$ jest backend/tests/login.test.ts
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    Wrong Password Test Error: Database error querying schema

      at Object.<anonymous> (backend/tests/login.test.ts:21:17)

  console.error
    SignUp failed: {
      "__isAuthError": true,
      "name": "AuthApiError",
      "status": 400,
      "code": "email_address_invalid"
    }

      33 |         });
      34 |         if (error) {
    > 35 |             console.error('SignUp failed:', JSON.stringify(error, null, 2));
         |                     ^
      36 |         } else {
      37 |             console.log('SignUp success:', data.user?.id);
      38 |         }

      at Object.<anonymous> (backend/tests/login.test.ts:35:21)

  console.error
    Login failed: Database error querying schema

      51 |
      52 |         if (error) {
    > 53 |             console.error('Login failed:', error.message);
         |                     ^
      54 |         }
      55 |
      56 |         expect(error).toBeNull();

      at Object.<anonymous> (backend/tests/login.test.ts:53:21)

FAIL backend/tests/login.test.ts
  Admin Login Verification
    ‚úì should return invalid credentials for wrong password (104 ms)
    ‚úï should sign up a new user (171 ms)
    ‚úï should successfully login as the seeded admin user (45 ms)
    ‚úï should retrieve the admin profile with correct branch (82 ms)

  ‚óè Admin Login Verification ‚Ä∫ should sign up a new user

    expect(received).toBeNull()

    Received: [AuthApiError: Email address "testuser1766406751923@test.com" is invalid]

      37 |             console.log('SignUp success:', data.user?.id);
      38 |         }
    > 39 |         expect(error).toBeNull();
         |                       ^
      40 |     });
      41 |
      42 |     // Credentials from V2__seed_admin.sql

      at Object.<anonymous> (backend/tests/login.test.ts:39:23)

  ‚óè Admin Login Verification ‚Ä∫ should successfully login as the seeded admin user

    expect(received).toBeNull()

    Received: [AuthApiError: Database error querying schema]

      54 |         }
      55 |
    > 56 |         expect(error).toBeNull();
         |                       ^
      57 |         expect(data.session).toBeDefined();
      58 |         expect(data.user).toBeDefined();
      59 |         expect(data.user?.email).toBe(email);

      at Object.<anonymous> (backend/tests/login.test.ts:56:23)

  ‚óè Admin Login Verification ‚Ä∫ should retrieve the admin profile with correct branch

    expect(received).toBeNull()

    Received: {"code": "PGRST116", "details": "The result contains 0 rows", "hint": null, "message": "Cannot coerce the result to a single JSON object"}

      69 |             .single();
      70 |
    > 71 |         expect(error).toBeNull();
         |                       ^
      72 |         expect(profile).toBeDefined();
      73 |         expect(profile.role).toBe('admin');
      74 |         expect(profile.branches?.branch_code).toBe('0001');

      at Object.<anonymous> (backend/tests/login.test.ts:71:23)

---------------------------|---------|----------|---------|---------|-------------------
File                       | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
---------------------------|---------|----------|---------|---------|-------------------
All files                  |       0 |        0 |       0 |       0 |                   
 backend/services          |       0 |        0 |       0 |       0 |                   
  addressService.ts        |       0 |        0 |       0 |       0 | 2-69              
  authService.ts           |       0 |        0 |       0 |       0 | 4-122             
  branchService.ts         |       0 |        0 |       0 |       0 | 2-74              
  clientService.ts         |       0 |        0 |       0 |       0 | 2-80              
  companyService.ts        |       0 |        0 |       0 |       0 | 2-67              
  dashboardService.ts      |       0 |        0 |       0 |       0 | 4-53              
  entityService.ts         |       0 |        0 |       0 |       0 | 2-69              
  nfeService.ts            |       0 |      100 |       0 |       0 | 2-34              
  notificationService.ts   |       0 |        0 |       0 |       0 | 4-72              
  orcamentoService.ts      |       0 |        0 |       0 |       0 | 2-17              
  ownerService.ts          |       0 |        0 |       0 |       0 | 2-63              
  personService.ts         |       0 |        0 |       0 |       0 | 2-68              
  preAnaliseService.ts     |       0 |        0 |       0 |       0 | 2-28              
  productService.ts        |       0 |        0 |       0 |       0 | 3-20              
  recebimentoService.ts    |       0 |      100 |       0 |       0 | 2-14              
  userManagementService.ts |       0 |        0 |       0 |       0 | 2-145             
 lib                       |       0 |        0 |       0 |       0 |                   
  audit.ts                 |       0 |        0 |       0 |       0 | 2-40              
  image.ts                 |       0 |        0 |       0 |       0 | 9-80              
  permissions.ts           |       0 |        0 |       0 |       0 | 2-25              
  storage.ts               |       0 |        0 |       0 |       0 | 2-43              
  supabase.ts              |       0 |        0 |     100 |       0 | 2-19              
---------------------------|---------|----------|---------|---------|-------------------
Test Suites: 1 failed, 1 total
Tests:       3 failed, 1 passed, 4 total
Snapshots:   0 total
Time:        1.324 s
Ran all test suites matching backend/tests/login.test.ts.
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
