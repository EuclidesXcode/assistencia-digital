yarn run v1.22.22
$ jest backend/tests/login.test.ts
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.local -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.error
    SignUp failed: {
      "__isAuthError": true,
      "name": "AuthApiError",
      "status": 400,
      "code": "email_address_invalid"
    }

      22 |         });
      23 |         if (error) {
    > 24 |             console.error('SignUp failed:', JSON.stringify(error, null, 2));
         |                     ^
      25 |         } else {
      26 |             console.log('SignUp success:', data.user?.id);
      27 |         }

      at Object.<anonymous> (backend/tests/login.test.ts:24:21)

  console.error
    Login failed: Database error querying schema

      40 |
      41 |         if (error) {
    > 42 |             console.error('Login failed:', error.message);
         |                     ^
      43 |         }
      44 |
      45 |         expect(error).toBeNull();

      at Object.<anonymous> (backend/tests/login.test.ts:42:21)

FAIL backend/tests/login.test.ts
  Admin Login Verification
    âœ• should sign up a new user (215 ms)
    âœ• should successfully login as the seeded admin user (40 ms)
    âœ• should retrieve the admin profile with correct branch (136 ms)

  â— Admin Login Verification â€º should sign up a new user

    expect(received).toBeNull()

    Received: [AuthApiError: Email address "test_1766406637381@example.com" is invalid]

      26 |             console.log('SignUp success:', data.user?.id);
      27 |         }
    > 28 |         expect(error).toBeNull();
         |                       ^
      29 |     });
      30 |
      31 |     // Credentials from V2__seed_admin.sql

      at Object.<anonymous> (backend/tests/login.test.ts:28:23)

  â— Admin Login Verification â€º should successfully login as the seeded admin user

    expect(received).toBeNull()

    Received: [AuthApiError: Database error querying schema]

      43 |         }
      44 |
    > 45 |         expect(error).toBeNull();
         |                       ^
      46 |         expect(data.session).toBeDefined();
      47 |         expect(data.user).toBeDefined();
      48 |         expect(data.user?.email).toBe(email);

      at Object.<anonymous> (backend/tests/login.test.ts:45:23)

  â— Admin Login Verification â€º should retrieve the admin profile with correct branch

    expect(received).toBeNull()

    Received: {"code": "PGRST116", "details": "The result contains 0 rows", "hint": null, "message": "Cannot coerce the result to a single JSON object"}

      58 |             .single();
      59 |
    > 60 |         expect(error).toBeNull();
         |                       ^
      61 |         expect(profile).toBeDefined();
      62 |         expect(profile.role).toBe('admin');
      63 |         expect(profile.branches?.branch_code).toBe('0001');

      at Object.<anonymous> (backend/tests/login.test.ts:60:23)

---------------------------|---------|----------|---------|---------|-------------------
File                       | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
---------------------------|---------|----------|---------|---------|-------------------
All files                  |       0 |        0 |       0 |       0 |                   
 backend/services          |       0 |        0 |       0 |       0 |                   
  addressService.ts        |       0 |        0 |       0 |       0 | 2-69              
  authService.ts           |       0 |        0 |       0 |       0 | 4-122             
  branchService.ts         |       0 |        0 |       0 |       0 | 2-74              
  clientService.ts         |       0 |        0 |       0 |       0 | 2-80              
  companyService.ts        |       0 |        0 |       0 |       0 | 2-67              
  dashboardService.ts      |       0 |        0 |       0 |       0 | 4-53              
  entityService.ts         |       0 |        0 |       0 |       0 | 2-69              
  nfeService.ts            |       0 |      100 |       0 |       0 | 2-34              
  notificationService.ts   |       0 |        0 |       0 |       0 | 4-72              
  orcamentoService.ts      |       0 |        0 |       0 |       0 | 2-17              
  ownerService.ts          |       0 |        0 |       0 |       0 | 2-63              
  personService.ts         |       0 |        0 |       0 |       0 | 2-68              
  preAnaliseService.ts     |       0 |        0 |       0 |       0 | 2-28              
  productService.ts        |       0 |        0 |       0 |       0 | 3-20              
  recebimentoService.ts    |       0 |      100 |       0 |       0 | 2-14              
  userManagementService.ts |       0 |        0 |       0 |       0 | 2-145             
 lib                       |       0 |        0 |       0 |       0 |                   
  audit.ts                 |       0 |        0 |       0 |       0 | 2-40              
  image.ts                 |       0 |        0 |       0 |       0 | 9-80              
  permissions.ts           |       0 |        0 |       0 |       0 | 2-25              
  storage.ts               |       0 |        0 |       0 |       0 | 2-43              
  supabase.ts              |       0 |        0 |     100 |       0 | 2-19              
---------------------------|---------|----------|---------|---------|-------------------
Test Suites: 1 failed, 1 total
Tests:       3 failed, 3 total
Snapshots:   0 total
Time:        1.354 s
Ran all test suites matching backend/tests/login.test.ts.
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
